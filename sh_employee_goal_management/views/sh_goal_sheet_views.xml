<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- ======================== FORM VIEW ======================== -->
    <record id="sh_goal_sheet_form" model="ir.ui.view">
        <field name="name">sh.goal.sheet.form</field>
        <field name="model">sh.goal.sheet</field>
        <field name="arch" type="xml">
            <form string="Goals" create="0" delete="0">
                <header>
                    <field name="is_coach" invisible="1" />
                    <field name="is_manager" invisible="1" />
                    <field name="submitted_by_coach" invisible="1" />
                    <field name="submitted_by_employee" invisible="1" />
                    <button type="object" class="btn btn-primary" name="action_submit_employee" string="Submit" attrs="{'invisible' : ['|','|','|',('stage','!=','draft'),('submitted_by_employee','=',True),('is_coach','!=',False),('is_manager','!=',False)]}" />
                    <button type="object" class="btn btn-primary" name="action_submit_coach" string="Submit TL" attrs="{'invisible' : ['|','|',('stage','!=','draft'),('is_coach','=',False),('submitted_by_coach','=',True)]}" />
                    <button type="object" class="btn btn-primary" name="action_submit_coach" string="Submit Manager" attrs="{'invisible' : ['|','|','|',('contract_id','=',False),('stage','!=','draft'),('is_manager','=',False),('submitted_by_coach','=',True)]}" />

                    <button type="object" class="btn btn-primary" name="action_agree" string="Agreed" attrs="{'invisible' : ['|',('stage','in', ['draft','done']),('is_coach','!=',False)]}" />
                    <button type="object" class="btn btn-primary" name="action_discussion" string="Discussion" attrs="{'invisible' : [('stage','in', ['draft','done','discussion','intermediate'])]}" />
                    <button type="object" class="btn btn-primary" name="action_intermediate" string="Intermediate" attrs="{'invisible' : [('stage','in', ['draft','done','intermediate','submitted'])]}" />
                    <button type="object" class="btn btn-primary" name="action_reset_to_draft_employee" string="Reset To Draft (Employee)" attrs="{'invisible' : ['|',('submitted_by_employee','=', False),('is_manager','=','False')]}" groups="project.group_project_manager"/>
                    <button type="object" class="btn btn-primary" name="action_reset_to_draft_coach" string="Reset To Draft (Coach)" attrs="{'invisible' : ['|',('submitted_by_coach','=', False),('is_manager','=','False')]}" groups="project.group_project_manager"/>
                    <field name="stage" widget="statusbar" />
                    <field name="allocation_id" invisible="1"/>
                    <field name="leaves_count" invisible="1"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object" groups="project.group_project_manager" 
                        name="view_goal_sheet" attrs="{'invisible' : [('stage','=','draft')]}"
                        style="font-size:12px;" class="oe_stat_button" icon="fa-bullseye">
                            Goal Sheet Lines
                        </button>
                        <button name="action_view_contract" type="object" style="font-size:12px;"
                            class="oe_stat_button" icon="fa-pencil-square-o"
                            attrs="{'invisible':[('contract_id','=',False)]}" groups="hr.group_hr_manager">
                            Contract
                        </button>
                         
                        <button name="action_view_allocation" type="object" style="font-size:12px;" groups="hr.group_hr_manager"
                            class="oe_stat_button" icon="fa-bars"
                            attrs="{'invisible':['|',('allocation_id','=',False),('contract_id','=',False)]}">
                            Leave Allocation
                        </button>
                        <button name="action_view_allocation_leaves" type="object" groups="hr.group_hr_manager"
                            style="font-size:12px;" class="oe_stat_button" icon="fa-bars"
                            attrs="{'invisible':['|',('leaves_count','=',0),('contract_id','=',False)]}">
                            <field name="leaves_count" widget="statinfo" string="Leaves" />
                        </button>
                        <button name="action_view_emp_timesheets" type="object" class="oe_stat_button" 
                        icon="fa-money" groups="hr.group_hr_manager" 
                        attrs="{'invisible':[('contract_id','=',False)]}">
                            <div class="o_stat_info">
                                <!-- <field name="sh_timesheet_count" class="o_stat_value" widget="timesheet_uom"/>  -->
                                <span class="o_stat_text">Timesheets</span>
                            </div>
                        </button>
                        <button name="action_view_emp_attendance" type="object" class="oe_stat_button" 
                        icon="fa-money" groups="hr.group_hr_manager" 
                        attrs="{'invisible':[('contract_id','=',False)]}">
                            <div class="o_stat_info">
                                <!-- <field name="sh_timesheet_count" class="o_stat_value" widget="timesheet_uom"/>  -->
                                <span class="o_stat_text">Attendance</span>
                            </div>
                        </button>
                        <button name="action_view_emp_attendance_modification_req" type="object" 
                        class="oe_stat_button" icon="fa-money" groups="hr.group_hr_manager"
                        attrs="{'invisible':[('contract_id','=',False)]}">
                            <div class="o_stat_info">
                                <!-- <field name="sh_timesheet_count" class="o_stat_value" widget="timesheet_uom"/>  -->
                                <span class="o_stat_text">Attendance <br/> Modification <br/> Request</span>
                            </div>
                        </button>
                        <!-- <button class="oe_stat_button" type="object" name="toggle_active" icon="fa-archive" groups="base.group_system">
                            <field name="active" widget="boolean_button" options="{&quot;terminology&quot;: &quot;archive&quot;}">Archive</field>
                        </button>
                         -->
                    </div>
                    <h1>
                        <field name="name" readonly="1" />
                        <!-- <field name="active" readonly="1"/> -->
                    </h1>
                    <group>
                        <group>
                            <field name="contract_id" invisible="1"/>
                            <field name="date_from" readonly="1" />
                            <field name="employee_id" readonly="1" />
                            <field name="coach_deadline" readonly="1" attrs="{'invisible' : [('is_coach','=',False)]}" />
                            <field name="employee_deadline" readonly="1" attrs="{'invisible' : [('is_coach','!=',False)]}" />
                            <field name="contract_id" groups="hr.group_hr_manager"/>
                        </group>
                        <group>
                            <field name="date_to" readonly="1" />
                            <field name="coach_id" readonly="0" />
                            <field name="manager_id" readonly="0" />
                            <field name="creation_type" readonly="1" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="detail_line" string="Goals" >
                            <field name="detail_ids" widget="section_and_note_one2many" attrs="{'readonly': [('stage','!=','draft')]}">
                                <tree editable="bottom" limit="80">
                                    <control>
                                        <create name="add_product_control" string="Add a line" />
                                        <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}" />
                                        <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}" />
                                    </control>
                                    <field name="dynamic_domain" invisible="1" />
                                    <field name="display_type" invisible="1" />
                                    <field name="need_rating" invisible="1" />
                                    <field name="name" widget="section_and_note_text" readonly="1" />
                                    <field name="description" optional="hide" readonly="1"/>
                                    <!-- <field name="description" readonly="1"/> -->
                                    <field name="is_required_for_emp" invisible="1"/>
                                    <field name="is_required_for_coach" invisible="1"/>
                                    <field name="employee_rating_id" domain="dynamic_domain" options="{'no_create':True,'no_create_edit':True}" 
                                    attrs="{'column_invisible' : ['&amp;',('parent.is_coach','=',True),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')],'readonly':[('need_rating','=',False)]}" />
                                    <field name="employee_comment" attrs="{'required':[('is_required_for_emp','=',True)],'column_invisible' : ['&amp;',('parent.is_coach','=',True),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')]}" />
                                    <field name="coach_rating_id" domain="dynamic_domain" options="{'no_create':True,'no_create_edit':True}" attrs="{'column_invisible' : [('parent.is_manager','=',False),('parent.is_coach','=',False),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')]}" />
                                    <field name="coach_comment" attrs="{'required':[('is_required_for_coach','=',True)],'column_invisible' : [('parent.is_manager','=',False),('parent.is_coach','=',False),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')]}" />
                                    
                                </tree>
                                <form>
                                    <group>
                                        <field name="display_type" invisible="1" />
                                        <field name="need_rating" invisible="1" />
                                        <field name="name" widget="section_and_note_text" readonly="1" />
                                        <field name="description" readonly="1" />
                                        <field name="employee_rating_id" options="{'no_create':True,'no_create_edit':True}" 
                                        attrs="{'column_invisible' : ['&amp;',('parent.is_coach','=',True),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')],'readonly':[('need_rating','=',False)]}" />
                                        <field name="employee_comment" attrs="{'column_invisible' : ['&amp;',('parent.is_coach','=',True),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')]}" />
                                        <field name="coach_rating_id" options="{'no_create':True,'no_create_edit':True}" attrs="{'column_invisible' : [('parent.is_manager','=',False),('parent.is_coach','=',False),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')]}" />
                                        <field name="coach_comment" attrs="{'column_invisible' : [('parent.is_manager','=',False),('parent.is_coach','=',False),'|',('parent.contract_id','!=',False),('parent.stage','=','draft')]}" />
                                        
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page name="message_to_manager" string="Message For Manager" 
                        attrs="{'invisible':[('is_manager','=',False),('is_coach','=',True)]}">
                            <group>
                                <field name="message_to_manager" placeholder="You can write here content which you want to share to manager only. Coach cannot see this content."
                                attrs="{'readonly': [('stage','!=','draft')]}"/>
                            </group>
                        </page>
                        <page string="Improvements" name="Improvements" groups="hr.group_hr_manager">
                            <field name="sh_contract_improvement_ids">
                                <tree editable="bottom">
                                    <field name="sequence" widget="handle" />
                                    <field name="name" />
                                </tree>
                            </field>
                        </page>
        
                        <page string="Goals" name="Goals" groups="hr.group_hr_manager">
                            <field name="sh_contract_goal_ids">
                                <tree editable="bottom">
                                    <field name="sequence" widget="handle" />
                                    <field name="name" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <!-- Chatter -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>
    <!-- ======================== TREE VIEW ======================== -->
    <record id="sh_goal_sheet_tree" model="ir.ui.view">
        <field name="name">sh.goal.sheet.tree</field>
        <field name="model">sh.goal.sheet</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="employee_id" />
                <field name="date_from" />
                <field name="date_to" />
                <field name="stage" />
            </tree>
        </field>
    </record>
    <!-- ======================== SEARCH VIEW ======================== -->
    <record id="sh_goal_sheet_search_view" model="ir.ui.view">
        <field name="name">goal.sheet.search.view</field>
        <field name="model">sh.goal.sheet</field>
        <field name="arch" type="xml">
            <search string="Goal Sheet">
                <field name="employee_id" />
                <field name="coach_id"/>
                <field name="stage" />
                <field name="date_from" />
                <field name="total_month" />
                <separator />
                <filter name="month" string="Date" date="date_from" />

                <filter name="message_to_manager" domain="[('message_to_manager', '!=', False)]" 
                string="Message to Manager is set"  groups="project.group_project_manager"/>

                <group name="group" string="Group By">
                    <filter name="status_filter" string="Stages" context="{'group_by':'stage'}" />
                    <filter name="status_employee" string="Employee" context="{'group_by':'employee_id'}" groups="project.group_project_manager"/>
                    <filter name="status_coach" string="Coach" context="{'group_by':'coach_id'}" groups="project.group_project_manager"/>
                    <filter name="status_manager" string="Manager" context="{'group_by':'manager_id'}" groups="project.group_project_manager"/>
                    <filter name="status_auto_employee" string="Auto Submit(Employee)" context="{'group_by':'auto_submitted_employee'}" groups="project.group_project_manager"/>
                    <filter name="status_auto_coach" string="Auto Submit(Coach)" context="{'group_by':'auto_submitted_coach'}" groups="project.group_project_manager"/>

                    <filter name="month_filter" string="Monthly" context="{'group_by':'total_month'}" />
                </group>
            </search>
        </field>
    </record>
    <!-- ======================== ACTION ======================== -->
    <record id="sh_goal_sheet_action" model="ir.actions.act_window">
        <field name="name">Goal Sheet</field>
        <field name="res_model">sh.goal.sheet</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Goal Sheet</p>
        </field>
    </record>
    <menuitem name="Goal Sheet" id="sh_goal_sheet_root" action="sh_goal_sheet_action" parent="sh_goal_management_root" sequence="5" />
</odoo>
