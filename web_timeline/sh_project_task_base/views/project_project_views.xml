<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 	project.project form view inherited-->
    <record id="sh_project_project_form_view_inherit" model="ir.ui.view">
        <field name="name">project.project.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project" />
        <field name="arch" type="xml">

            <!-- Timesheet and task smart button -->
            <xpath expr="//sheet//div[@name='button_box']" position="inside">

                <button class="oe_stat_button"
                    name="%(project.act_project_project_2_project_task_all)d"
                    type="action" icon="fa-tasks" groups="project.group_project_manager">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="task_count" nolabel="1" />
                        </span>
                        <span class="o_stat_text">
                            Tasks
                        </span>
                    </div>
                </button>
                <button class="oe_stat_button"
                    name="%(hr_timesheet.act_hr_timesheet_line_by_project)d"
                    type="action" icon="fa-calendar"
                    attrs="{'invisible': [('allow_timesheets', '=', False)]}">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="allow_timesheets" nolabel="1" invisible='1' />
                        </span>
                        <span class="o_stat_text">
                            Timesheets
                        </span>
                    </div>
                </button>


            </xpath>

            <!-- ==========  FOR PROJECT STAGES ================ -->
            <xpath expr="//page[@name='settings']" position="after">
                <page string="Task Stages" name="task_stages">
                    <group>
                        <group>
                            <field name="sh_stage_template_id" />
                            <field name="sh_stage_ids" widget="many2many_tags" />
                        </group>
                    </group>
                </page>
            </xpath>

            <field name="tag_ids" position='after'>
                <field name="responsible_user_ids" widget="many2many_tags" domain="[('share','=',False)]" />
                <field name="project_type_selection" widget="radio" options="{'horizontal': True}"/>
            </field>

            <field name="user_id" position="after">
                <field name="sh_technical_head" />
                <field name="sh_designing_head" />

            </field>
            <xpath expr="//div[hasclass('oe_chatter')]" position="replace">
                <div class="o_attachment_preview"/>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </xpath>

            <xpath expr="//form//group//group[2]" position="inside">
                <field name="sh_deadline_n_estimated_hours_mendatory" />
                <field name="is_task_editable_in_done_stage" groups="project.group_project_manager"/>
                <field name="sl_can_create_task" groups="project.group_project_manager"/>
            </xpath>
            
        </field>
    </record>

    <!-- 	project.project tree view inherited-->
    <record id="sh_project_project_tree_view_inherit" model="ir.ui.view">
        <field name="name">project.project.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project" />
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="stage_id" />
            </field>
        </field>
    </record>

    <record id="sh_project_project_hr_timesheet_inherit_" model="ir.ui.view">
        <field name="name">sh.project.project.hr.timesheet.inherit.form.view</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="hr_timesheet.project_invoice_form"/>
        <field name="arch" type="xml">
            <field name="allocated_hours" position="before">
                <label for="support_start_date" string="Support Date"/>
                <div name="dates" class="o_row">
                    <field name="support_start_date" widget="daterange" options="{&quot;related_end_date&quot;: &quot;support_end_date&quot;}"/>
                    <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
                    <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('support_start_date', '=', False), ('support_end_date', '=', False)]}"/>
                    <field name="support_end_date" widget="daterange" options="{&quot;related_start_date&quot;: &quot;support_start_date&quot;}"/>
                </div>
                
            </field>
        </field>
    </record>

    <!-- <record id="sh_project_project_stages_kanban" model="ir.ui.view">
        <field name="name">project.project.kanban</field>
        <field name="model">project.project</field>
        <field name="priority" eval="100" />
        <field name="inherit_id" ref="project.project_view_kanban" />
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="replace">
                <kanban default_group_by="stage_id" class="o_kanban_small_column o_kanban_project_tasks">
                    <field name="user_id" string="Project Manager" />
                    <field name="stage_id" />
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_content oe_kanban_global_click o_kanban_get_form">
                                <div class="row">
                                    <div class="col-12">
                                        <strong><field name="name" string="Project Name" /></strong>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-8">
                                        <field name="partner_id" string="Contact" />
                                    </div>
                                    <div class="col-4">
                                        <div class="oe_kanban_bottom_right">
                                            <img
                                                t-att-src="kanban_image('res.users', 'image_128', record.user_id.raw_value)"
                                                t-att-title="record.user_id.value"
                                                t-att-alt="record.user_id.value"
                                                class="oe_kanban_avatar o_image_24_cover float-right"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </xpath>
        </field>
    </record> -->

    <!-- Add attribute for default group by stage in kanban view -->
    <!-- <record id="sh_project_project_stages_kanban" model="ir.ui.view">
        <field name="name">project.project.kanban</field>
        <field name="model">project.project</field>
        <field name="priority" eval="100" />
        <field name="inherit_id" ref="project.view_project_kanban" />
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="default_group_by">stage_id</attribute>
            </xpath>
        </field>
    </record> -->

    <!-- <record id="sh_project_project_stages_search" model="ir.ui.view">
        <field name="name">project.project.search</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_project_filter" />
        <field name="arch" type="xml">
            <xpath expr="//search/group/filter" position="after">
                <filter string="Project Stages" name="stage_id" context="{'group_by': 'stage_id'}" />
            </xpath>
        </field>
    </record> -->


    <record id="project.view_task_kanban_inherit_my_task" model="ir.ui.view">
        <field name="name">project.task.kanban.inherit.my.task</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="default_group_by">stage_id</attribute>
            </xpath>
        </field>
    </record>

    <!-- Added Custom Group By in project.project Search View -->
    <record id="sh_project_project_view_project_groupby" model="ir.ui.view">
        <field name="name">sh.project.project.select.project.groupby</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_project_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="project_type_selection" />
            </xpath>

            <xpath expr="//search//group" position="inside">
                <filter string="Project Type" name="groupby_project_type" context="{'group_by': 'project_type_selection'}" />
            </xpath>
        </field>
    </record>
</odoo>
